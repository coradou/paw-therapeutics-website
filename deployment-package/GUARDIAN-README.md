# ğŸ›¡ï¸ çˆªå­åˆ¶è¯ç½‘ç«™å®ˆæŠ¤è¿›ç¨‹ç³»ç»Ÿ

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ˆæŠ¤è¿›ç¨‹ç³»ç»Ÿä¸ºæ‚¨çš„ç½‘ç«™æä¾›å…¨æ–¹ä½çš„ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤åŠŸèƒ½ï¼Œç¡®ä¿å‰åç«¯æœåŠ¡å§‹ç»ˆç¨³å®šè¿è¡Œã€‚

### âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **ğŸ” å…¨æ–¹ä½ç›‘æ§**: PM2è¿›ç¨‹ã€ç«¯å£ç›‘å¬ã€HTTPå“åº”ã€APIç«¯ç‚¹
- **ğŸ”„ è‡ªåŠ¨é‡å¯**: æ£€æµ‹åˆ°æ•…éšœæ—¶è‡ªåŠ¨é‡å¯æœåŠ¡
- **ğŸš¨ å®æ—¶é€šçŸ¥**: æ”¯æŒä¼ä¸šå¾®ä¿¡å’ŒServeré…±é€šçŸ¥
- **ğŸ“Š ç³»ç»Ÿç›‘æ§**: å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡ç›‘æ§
- **ğŸ› ï¸ ç´§æ€¥ä¿®å¤**: å¤šçº§ä¿®å¤ç­–ç•¥ï¼ŒåŒ…æ‹¬æ¸…ç†åƒµå°¸è¿›ç¨‹ã€ä¿®å¤æƒé™ç­‰
- **ğŸ“ è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„è¿è¡Œå’Œæ•…éšœæ—¥å¿—è®°å½•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€å¯åŠ¨
```bash
# å¯åŠ¨ç½‘ç«™æœåŠ¡
./start-server.sh

# å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼ˆæ¨èï¼‰
./manage-guardian.sh start
```

### 2. ç³»ç»ŸæœåŠ¡å®‰è£…ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# å®‰è£…ä¸ºç³»ç»ŸæœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰
sudo ./manage-guardian.sh install-service

# å¯åŠ¨ç³»ç»ŸæœåŠ¡
sudo ./manage-guardian.sh service-start
```

## ğŸ“– å‘½ä»¤è¯¦è§£

### ç®¡ç†å‘½ä»¤
```bash
# æŸ¥çœ‹çŠ¶æ€ï¼ˆæœ€å¸¸ç”¨ï¼‰
./manage-guardian.sh status

# æ‰‹åŠ¨å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
./manage-guardian.sh start

# åœæ­¢å®ˆæŠ¤è¿›ç¨‹
./manage-guardian.sh stop

# é‡å¯å®ˆæŠ¤è¿›ç¨‹
./manage-guardian.sh restart
```

### ç³»ç»ŸæœåŠ¡å‘½ä»¤
```bash
# å®‰è£…ä¸ºç³»ç»ŸæœåŠ¡
sudo ./manage-guardian.sh install-service

# å¸è½½ç³»ç»ŸæœåŠ¡
sudo ./manage-guardian.sh uninstall-service

# å¯åŠ¨ç³»ç»ŸæœåŠ¡
sudo ./manage-guardian.sh service-start

# åœæ­¢ç³»ç»ŸæœåŠ¡
sudo ./manage-guardian.sh service-stop
```

### æ—¥å¿—å’Œè¯Šæ–­
```bash
# æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹æ—¥å¿—
./manage-guardian.sh logs

# æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
./manage-guardian.sh clean-logs

# è¯Šæ–­502é”™è¯¯
./diagnose-502.sh
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

**1. 502é”™è¯¯æ€ä¹ˆåŠï¼Ÿ**
```bash
# è¿è¡Œè¯Šæ–­å·¥å…·
./diagnose-502.sh

# å¦‚æœå®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œï¼Œå¯åŠ¨å®ƒ
./manage-guardian.sh start
```

**2. å¦‚ä½•æŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼Ÿ**
```bash
# æŸ¥çœ‹å®Œæ•´çŠ¶æ€
./manage-guardian.sh status

# æŸ¥çœ‹PM2çŠ¶æ€
pm2 status

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tlnp | grep :3000
```

**3. å†…å­˜ä½¿ç”¨è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ**
- å®ˆæŠ¤è¿›ç¨‹ä¼šè‡ªåŠ¨ç›‘æ§å†…å­˜ä½¿ç”¨ç‡
- è¶…è¿‡è®¾å®šé˜ˆå€¼ä¼šè‡ªåŠ¨é‡å¯æœåŠ¡
- å¯ä»¥é€šè¿‡ecosystem.config.jsè°ƒæ•´å†…å­˜é™åˆ¶

**4. å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ**
```bash
# å®ˆæŠ¤è¿›ç¨‹æ—¥å¿—
./manage-guardian.sh logs

# PM2æœåŠ¡æ—¥å¿—
pm2 logs paw-website

# ç³»ç»ŸæœåŠ¡æ—¥å¿—ï¼ˆå¦‚æœä½¿ç”¨systemdï¼‰
sudo journalctl -u paw-website -f
```

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡é…ç½®
åœ¨ `.env.local` æ–‡ä»¶ä¸­é…ç½®é€šçŸ¥æœåŠ¡ï¼š

```env
# ä¼ä¸šå¾®ä¿¡é€šçŸ¥
WECHAT_WEBHOOK_URL=https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=your_key

# Serveré…±é€šçŸ¥
SERVER_CHAN_KEY=your_server_chan_key
```

### å®ˆæŠ¤è¿›ç¨‹é…ç½®
åœ¨ `guardian-daemon.sh` ä¸­å¯ä»¥è°ƒæ•´ï¼š

```bash
HEALTH_CHECK_INTERVAL=30     # å¥åº·æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
MAX_RESTART_ATTEMPTS=5       # æœ€å¤§é‡å¯å°è¯•æ¬¡æ•°
```

### PM2é…ç½®
åœ¨ `ecosystem.config.js` ä¸­è°ƒæ•´ï¼š

```javascript
max_memory_restart: '500M'   # å†…å­˜è¶…è¿‡500Mè‡ªåŠ¨é‡å¯
instances: 1                 # è¿›ç¨‹å®ä¾‹æ•°
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

å®ˆæŠ¤è¿›ç¨‹ä¼šç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š

- **PM2è¿›ç¨‹çŠ¶æ€**: æ£€æŸ¥è¿›ç¨‹æ˜¯å¦åœ¨çº¿
- **ç«¯å£ç›‘å¬**: æ£€æŸ¥3000ç«¯å£æ˜¯å¦å¯ç”¨
- **HTTPå“åº”**: æ£€æŸ¥ç½‘ç«™æ˜¯å¦å¯è®¿é—®
- **APIç«¯ç‚¹**: æ£€æŸ¥å…³é”®APIæ˜¯å¦æ­£å¸¸
- **ç³»ç»Ÿèµ„æº**: å†…å­˜å’Œç£ç›˜ä½¿ç”¨ç‡
- **è¿›ç¨‹å¥åº·**: æ£€æµ‹åƒµå°¸è¿›ç¨‹å’Œå¼‚å¸¸æƒ…å†µ

## ğŸš¨ é€šçŸ¥åŠŸèƒ½

### é€šçŸ¥äº‹ä»¶
- å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨/åœæ­¢
- æœåŠ¡æ•…éšœæ£€æµ‹
- è‡ªåŠ¨æ¢å¤æˆåŠŸ/å¤±è´¥
- èµ„æºä½¿ç”¨ç‡è­¦å‘Š
- ç´§æ€¥æ•…éšœéœ€è¦äººå·¥å¹²é¢„

### é…ç½®é€šçŸ¥
1. **ä¼ä¸šå¾®ä¿¡**ï¼ˆæ¨èï¼‰ï¼šåˆ›å»ºç¾¤æœºå™¨äººè·å–Webhook URL
2. **Serveré…±**ï¼šç»‘å®šå¾®ä¿¡è·å–SendKey

## ğŸ¯ æœ€ä½³å®è·µ

### ç”Ÿäº§ç¯å¢ƒå»ºè®®
1. **ä½¿ç”¨ç³»ç»ŸæœåŠ¡**: `sudo ./manage-guardian.sh install-service`
2. **é…ç½®é€šçŸ¥**: è®¾ç½®ä¼ä¸šå¾®ä¿¡æˆ–Serveré…±é€šçŸ¥
3. **å®šæœŸæ£€æŸ¥**: æ¯å‘¨æŸ¥çœ‹ `./manage-guardian.sh status`
4. **æ—¥å¿—è½®è½¬**: å®šæœŸè¿è¡Œ `./manage-guardian.sh clean-logs`

### å¼€å‘ç¯å¢ƒå»ºè®®
1. **æ‰‹åŠ¨å¯åŠ¨**: `./manage-guardian.sh start`
2. **å®æ—¶ç›‘æ§**: `./manage-guardian.sh logs` æŸ¥çœ‹æ—¥å¿—
3. **å¿«é€Ÿè¯Šæ–­**: é‡åˆ°é—®é¢˜æ—¶è¿è¡Œ `./diagnose-502.sh`

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å†…å­˜ä¼˜åŒ–
- PM2è‡ªåŠ¨é‡å¯å†…å­˜è¶…é™è¿›ç¨‹
- å®ˆæŠ¤è¿›ç¨‹ç›‘æ§ç³»ç»Ÿå†…å­˜ä½¿ç”¨
- å¯è°ƒæ•´ `max_memory_restart` å‚æ•°

### æ•…éšœæ¢å¤
- 5çº§æ•…éšœæ¢å¤ç­–ç•¥
- ä»è½»é‡çº§é‡å¯åˆ°æ·±åº¦æ¸…ç†
- è¶…è¿‡é‡è¯•æ¬¡æ•°æ—¶äººå·¥å¹²é¢„

### æ—¥å¿—ç®¡ç†
- è‡ªåŠ¨æ—¥å¿—è½®è½¬
- ä¿ç•™å…³é”®é”™è¯¯ä¿¡æ¯
- æ”¯æŒè¿œç¨‹æ—¥å¿—æŸ¥çœ‹

## ğŸ”’ å®‰å…¨è¯´æ˜

- å®ˆæŠ¤è¿›ç¨‹ä»¥érootæƒé™è¿è¡Œï¼ˆå»ºè®®ï¼‰
- ç³»ç»ŸæœåŠ¡é…ç½®äº†å®‰å…¨é™åˆ¶
- æ—¥å¿—æ–‡ä»¶æƒé™æ§åˆ¶
- ç¯å¢ƒå˜é‡å®‰å…¨åŠ è½½

## ğŸ†˜ è·å–å¸®åŠ©

```bash
# æŸ¥çœ‹å®Œæ•´å¸®åŠ©
./manage-guardian.sh help

# æŸ¥çœ‹è¯Šæ–­ä¿¡æ¯
./diagnose-502.sh

# æŸ¥çœ‹å®æ—¶çŠ¶æ€
./manage-guardian.sh status
```

---

**ğŸ’¡ æç¤º**: é¦–æ¬¡éƒ¨ç½²åå»ºè®®ç«‹å³è¿è¡Œ `./manage-guardian.sh start` å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹ï¼Œç¡®ä¿æœåŠ¡ç¨³å®šæ€§ã€‚ 