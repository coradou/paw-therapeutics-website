"use strict";(()=>{var e={};e.id=846,e.ids=[846],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},3683:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>p,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>h});var r={};n.r(r),n.d(r,{GET:()=>c,PUT:()=>d});var a=n(884),i=n(6132),s=n(1040),u=n(5798),o=n(8192),l=n(2429);async function c(e){let t=(0,o.G3)(e);if(!t.isAuthenticated)return u.Z.json({error:"未授权访问"},{status:401});try{let t=new URL(e.url),n="true"===t.searchParams.get("stats"),r=await (0,l.getAllResumes)();if(n){let e=await (0,l.getResumeStats)();return u.Z.json({resumes:r,stats:e})}return u.Z.json({resumes:r})}catch(e){return u.Z.json({error:"获取简历数据失败"},{status:500})}}async function d(e){let t=(0,o.G3)(e);if(!t.isAuthenticated)return u.Z.json({error:"未授权访问"},{status:401});try{let{id:t,...n}=await e.json();if(!t)return u.Z.json({error:"缺少简历ID"},{status:400});let r=await (0,l.updateResume)(t,n);if(!r)return u.Z.json({error:"简历不存在"},{status:404});return u.Z.json({success:!0,resume:r})}catch(e){return u.Z.json({error:"更新简历失败"},{status:500})}}let f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/resumes/route",pathname:"/api/admin/resumes",filename:"route",bundlePath:"app/api/admin/resumes/route"},resolvedPagePath:"/Users/freeninglu/Desktop/paw-therapeutics-website-main /app/api/admin/resumes/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:w,serverHooks:p,headerHooks:g,staticGenerationBailout:h}=f,y="/api/admin/resumes/route";function v(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:w})}},8192:(e,t,n)=>{n.d(t,{G3:()=>s,LC:()=>i,bD:()=>a});let r={username:"admin",password:"paw2024admin!"};function a(e,t){return e===r.username&&t===r.password}function i(e){let t={username:e,loginTime:new Date().toISOString(),exp:Date.now()+864e5};return Buffer.from(JSON.stringify(t)).toString("base64")}function s(e){let t=e.cookies.get("admin_session")?.value||e.headers.get("Authorization")?.replace("Bearer ","");return t?function(e){try{let t=JSON.parse(Buffer.from(e,"base64").toString());if(Date.now()>t.exp)return{isAuthenticated:!1};return{isAuthenticated:!0,username:t.username,loginTime:t.loginTime}}catch(e){return{isAuthenticated:!1}}}(t):{isAuthenticated:!1}}},2429:(e,t,n)=>{n.r(t),n.d(t,{getAllContacts:()=>y,getAllInterviews:()=>x,getAllResumes:()=>f,getContactById:()=>j,getContactStats:()=>A,getInterviewById:()=>J,getInterviewStats:()=>N,getResumeById:()=>p,getResumeFilePath:()=>h,getResumeStats:()=>I,saveContact:()=>v,saveInterviewData:()=>F,saveResume:()=>m,saveResumeFile:()=>g,updateContact:()=>S,updateInterview:()=>R,updateResume:()=>w});var r=n(7147),a=n(1017),i=n.n(a);let s=i().join(process.cwd(),"data"),u=i().join(s,"resumes.json"),o=i().join(s,"contacts.json"),l=i().join(s,"interviews.json"),c=i().join(s,"uploads");async function d(){try{await r.promises.mkdir(s,{recursive:!0}),await r.promises.mkdir(c,{recursive:!0})}catch(e){}}async function f(){try{await d();let e=await r.promises.readFile(u,"utf-8");return JSON.parse(e)}catch(e){return[]}}async function m(e){await d();let t=await f(),n={...e,id:O(),submittedAt:new Date().toISOString(),status:"new"};return t.push(n),await r.promises.writeFile(u,JSON.stringify(t,null,2)),n}async function w(e,t){let n=await f(),a=n.findIndex(t=>t.id===e);return -1===a?null:(n[a]={...n[a],...t},await r.promises.writeFile(u,JSON.stringify(n,null,2)),n[a])}async function p(e){let t=await f();return t.find(t=>t.id===e)||null}async function g(e,t){await d();let n=i().extname(e.name),a=`${t}${n}`,s=i().join(c,a),u=await e.arrayBuffer();return await r.promises.writeFile(s,Buffer.from(u)),a}function h(e){return i().join(c,e)}async function y(){try{await d();let e=await r.promises.readFile(o,"utf-8");return JSON.parse(e)}catch(e){return[]}}async function v(e){await d();let t=await y(),n={...e,id:O(),submittedAt:new Date().toISOString(),status:"new"};return t.unshift(n),await r.promises.writeFile(o,JSON.stringify(t,null,2)),n}async function S(e,t){let n=await y(),a=n.findIndex(t=>t.id===e);return -1===a?null:(n[a]={...n[a],...t},await r.promises.writeFile(o,JSON.stringify(n,null,2)),n[a])}async function j(e){let t=await y();return t.find(t=>t.id===e)||null}async function A(){let e=await y();return{total:e.length,new:e.filter(e=>"new"===e.status).length,read:e.filter(e=>"read"===e.status).length,replied:e.filter(e=>"replied"===e.status).length,archived:e.filter(e=>"archived"===e.status).length}}function O(){return Math.random().toString(36).substr(2,15)}async function I(){let e=await f();return{total:e.length,new:e.filter(e=>"new"===e.status).length,reviewed:e.filter(e=>"reviewed"===e.status).length,contacted:e.filter(e=>"contacted"===e.status).length,rejected:e.filter(e=>"rejected"===e.status).length,analyzed:e.filter(e=>e.aiAnalysis).length}}async function x(){try{await d();let e=await r.promises.readFile(l,"utf-8");return JSON.parse(e)}catch(e){return[]}}async function F(e){let t=await x(),n={...e,id:O(),status:"new"};return t.push(n),await r.promises.writeFile(l,JSON.stringify(t,null,2)),n}async function R(e,t){let n=await x(),a=n.findIndex(t=>t.id===e);return -1===a?null:(n[a]={...n[a],...t},await d(),await r.promises.writeFile(l,JSON.stringify(n,null,2)),n[a])}async function J(e){let t=await x();return t.find(t=>t.id===e)||null}async function N(){let e=await x(),t=e.length,n=e.filter(e=>"new"===e.status).length,r=e.filter(e=>"reviewed"===e.status).length,a=e.filter(e=>"contacted"===e.status).length,i=e.map(e=>e.evaluation.overallScore).filter(e=>e>0),s=i.length>0?Math.round(i.reduce((e,t)=>e+t,0)/i.length):0,u=e.filter(e=>"recommended"===e.evaluation.recommendation).length,o=e.filter(e=>"consider"===e.evaluation.recommendation).length,l=e.filter(e=>"not_recommended"===e.evaluation.recommendation).length;return{total:t,new:n,reviewed:r,contacted:a,rejected:e.filter(e=>"rejected"===e.status).length,averageScore:s,recommendations:{recommended:u,consider:o,notRecommended:l}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[271,107],()=>n(3683));module.exports=r})();