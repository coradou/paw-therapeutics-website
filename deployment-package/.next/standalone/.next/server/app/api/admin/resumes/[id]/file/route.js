"use strict";(()=>{var e={};e.id=422,e.ids=[422],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},6495:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>y,originalPathname:()=>S,patchFetch:()=>j,requestAsyncStorage:()=>w,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>v});var a={};n.r(a),n.d(a,{GET:()=>f});var i=n(884),r=n(6132),s=n(1040),o=n(5798),u=n(8192),l=n(2429),c=n(7147),d=n(1017),m=n.n(d);async function f(e,{params:t}){let n=(0,u.G3)(e);if(!n.isAuthenticated)return o.Z.json({error:"未授权访问"},{status:401});try{let n=await (0,l.getResumeById)(t.id);if(!n)return o.Z.json({error:"简历不存在"},{status:404});let a=m().extname(n.resumeFileName),i=`${t.id}${a}`,r=m().join(process.cwd(),"data","uploads",i);try{let t=await c.promises.readFile(r),a=new URL(e.url),i=a.searchParams.get("action"),s=m().extname(n.resumeFileName).toLowerCase(),u="application/octet-stream";switch(s){case".pdf":u="application/pdf";break;case".doc":u="application/msword";break;case".docx":u="application/vnd.openxmlformats-officedocument.wordprocessingml.document";break;case".txt":u="text/plain"}let l=new o.Z(t);return l.headers.set("Content-Type",u),"download"===i?l.headers.set("Content-Disposition",`attachment; filename="${encodeURIComponent(n.resumeFileName)}"`):l.headers.set("Content-Disposition",`inline; filename="${encodeURIComponent(n.resumeFileName)}"`),l}catch(e){return o.Z.json({error:"文件不存在"},{status:404})}}catch(e){return o.Z.json({error:"文件服务失败"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/admin/resumes/[id]/file/route",pathname:"/api/admin/resumes/[id]/file",filename:"route",bundlePath:"app/api/admin/resumes/[id]/file/route"},resolvedPagePath:"/Users/freeninglu/Desktop/paw-therapeutics-website-main /app/api/admin/resumes/[id]/file/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:h,serverHooks:g,headerHooks:y,staticGenerationBailout:v}=p,S="/api/admin/resumes/[id]/file/route";function j(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},8192:(e,t,n)=>{n.d(t,{G3:()=>s,LC:()=>r,bD:()=>i});let a={username:"admin",password:"paw2024admin!"};function i(e,t){return e===a.username&&t===a.password}function r(e){let t={username:e,loginTime:new Date().toISOString(),exp:Date.now()+864e5};return Buffer.from(JSON.stringify(t)).toString("base64")}function s(e){let t=e.cookies.get("admin_session")?.value||e.headers.get("Authorization")?.replace("Bearer ","");return t?function(e){try{let t=JSON.parse(Buffer.from(e,"base64").toString());if(Date.now()>t.exp)return{isAuthenticated:!1};return{isAuthenticated:!0,username:t.username,loginTime:t.loginTime}}catch(e){return{isAuthenticated:!1}}}(t):{isAuthenticated:!1}}},2429:(e,t,n)=>{n.r(t),n.d(t,{getAllContacts:()=>y,getAllInterviews:()=>A,getAllResumes:()=>m,getContactById:()=>j,getContactStats:()=>x,getInterviewById:()=>C,getInterviewStats:()=>R,getResumeById:()=>w,getResumeFilePath:()=>g,getResumeStats:()=>I,saveContact:()=>v,saveInterviewData:()=>O,saveResume:()=>f,saveResumeFile:()=>h,updateContact:()=>S,updateInterview:()=>N,updateResume:()=>p});var a=n(7147),i=n(1017),r=n.n(i);let s=r().join(process.cwd(),"data"),o=r().join(s,"resumes.json"),u=r().join(s,"contacts.json"),l=r().join(s,"interviews.json"),c=r().join(s,"uploads");async function d(){try{await a.promises.mkdir(s,{recursive:!0}),await a.promises.mkdir(c,{recursive:!0})}catch(e){}}async function m(){try{await d();let e=await a.promises.readFile(o,"utf-8");return JSON.parse(e)}catch(e){return[]}}async function f(e){await d();let t=await m(),n={...e,id:F(),submittedAt:new Date().toISOString(),status:"new"};return t.push(n),await a.promises.writeFile(o,JSON.stringify(t,null,2)),n}async function p(e,t){let n=await m(),i=n.findIndex(t=>t.id===e);return -1===i?null:(n[i]={...n[i],...t},await a.promises.writeFile(o,JSON.stringify(n,null,2)),n[i])}async function w(e){let t=await m();return t.find(t=>t.id===e)||null}async function h(e,t){await d();let n=r().extname(e.name),i=`${t}${n}`,s=r().join(c,i),o=await e.arrayBuffer();return await a.promises.writeFile(s,Buffer.from(o)),i}function g(e){return r().join(c,e)}async function y(){try{await d();let e=await a.promises.readFile(u,"utf-8");return JSON.parse(e)}catch(e){return[]}}async function v(e){await d();let t=await y(),n={...e,id:F(),submittedAt:new Date().toISOString(),status:"new"};return t.unshift(n),await a.promises.writeFile(u,JSON.stringify(t,null,2)),n}async function S(e,t){let n=await y(),i=n.findIndex(t=>t.id===e);return -1===i?null:(n[i]={...n[i],...t},await a.promises.writeFile(u,JSON.stringify(n,null,2)),n[i])}async function j(e){let t=await y();return t.find(t=>t.id===e)||null}async function x(){let e=await y();return{total:e.length,new:e.filter(e=>"new"===e.status).length,read:e.filter(e=>"read"===e.status).length,replied:e.filter(e=>"replied"===e.status).length,archived:e.filter(e=>"archived"===e.status).length}}function F(){return Math.random().toString(36).substr(2,15)}async function I(){let e=await m();return{total:e.length,new:e.filter(e=>"new"===e.status).length,reviewed:e.filter(e=>"reviewed"===e.status).length,contacted:e.filter(e=>"contacted"===e.status).length,rejected:e.filter(e=>"rejected"===e.status).length,analyzed:e.filter(e=>e.aiAnalysis).length}}async function A(){try{await d();let e=await a.promises.readFile(l,"utf-8");return JSON.parse(e)}catch(e){return[]}}async function O(e){let t=await A(),n={...e,id:F(),status:"new"};return t.push(n),await a.promises.writeFile(l,JSON.stringify(t,null,2)),n}async function N(e,t){let n=await A(),i=n.findIndex(t=>t.id===e);return -1===i?null:(n[i]={...n[i],...t},await d(),await a.promises.writeFile(l,JSON.stringify(n,null,2)),n[i])}async function C(e){let t=await A();return t.find(t=>t.id===e)||null}async function R(){let e=await A(),t=e.length,n=e.filter(e=>"new"===e.status).length,a=e.filter(e=>"reviewed"===e.status).length,i=e.filter(e=>"contacted"===e.status).length,r=e.map(e=>e.evaluation.overallScore).filter(e=>e>0),s=r.length>0?Math.round(r.reduce((e,t)=>e+t,0)/r.length):0,o=e.filter(e=>"recommended"===e.evaluation.recommendation).length,u=e.filter(e=>"consider"===e.evaluation.recommendation).length,l=e.filter(e=>"not_recommended"===e.evaluation.recommendation).length;return{total:t,new:n,reviewed:a,contacted:i,rejected:e.filter(e=>"rejected"===e.status).length,averageScore:s,recommendations:{recommended:o,consider:u,notRecommended:l}}}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[271,107],()=>n(6495));module.exports=a})();