"use strict";(()=>{var t={};t.id=984,t.ids=[984],t.modules={517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7147:t=>{t.exports=require("fs")},1017:t=>{t.exports=require("path")},9358:(t,e,n)=>{n.r(e),n.d(e,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>p,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>h});var a={};n.r(a),n.d(a,{GET:()=>c,PUT:()=>d});var r=n(884),i=n(6132),s=n(1040),u=n(5798),o=n(8192),l=n(2429);async function c(t){let e=(0,o.G3)(t);if(!e.isAuthenticated)return u.Z.json({error:"未授权访问"},{status:401});try{let e=new URL(t.url),n="true"===e.searchParams.get("stats"),a=await (0,l.getAllContacts)();if(n){let t=await (0,l.getContactStats)();return u.Z.json({contacts:a,stats:t})}return u.Z.json({contacts:a})}catch(t){return u.Z.json({error:"获取联系信息失败"},{status:500})}}async function d(t){let e=(0,o.G3)(t);if(!e.isAuthenticated)return u.Z.json({error:"未授权访问"},{status:401});try{let{id:e,status:n,notes:a,repliedAt:r}=await t.json();if(!e)return u.Z.json({error:"缺少联系信息ID"},{status:400});let i={};n&&(i.status=n),void 0!==a&&(i.notes=a),r&&(i.repliedAt=r);let s=await (0,l.updateContact)(e,i);if(!s)return u.Z.json({error:"联系信息不存在"},{status:404});return u.Z.json({contact:s})}catch(t){return u.Z.json({error:"更新联系信息失败"},{status:500})}}let f=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/contacts/route",pathname:"/api/admin/contacts",filename:"route",bundlePath:"app/api/admin/contacts/route"},resolvedPagePath:"/Users/freeninglu/Desktop/paw-therapeutics-website-main /app/api/admin/contacts/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:m,serverHooks:p,headerHooks:g,staticGenerationBailout:h}=f,y="/api/admin/contacts/route";function v(){return(0,s.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:m})}},8192:(t,e,n)=>{n.d(e,{G3:()=>s,LC:()=>i,bD:()=>r});let a={username:"admin",password:"paw2024admin!"};function r(t,e){return t===a.username&&e===a.password}function i(t){let e={username:t,loginTime:new Date().toISOString(),exp:Date.now()+864e5};return Buffer.from(JSON.stringify(e)).toString("base64")}function s(t){let e=t.cookies.get("admin_session")?.value||t.headers.get("Authorization")?.replace("Bearer ","");return e?function(t){try{let e=JSON.parse(Buffer.from(t,"base64").toString());if(Date.now()>e.exp)return{isAuthenticated:!1};return{isAuthenticated:!0,username:e.username,loginTime:e.loginTime}}catch(t){return{isAuthenticated:!1}}}(e):{isAuthenticated:!1}}},2429:(t,e,n)=>{n.r(e),n.d(e,{getAllContacts:()=>y,getAllInterviews:()=>x,getAllResumes:()=>f,getContactById:()=>j,getContactStats:()=>A,getInterviewById:()=>J,getInterviewStats:()=>N,getResumeById:()=>p,getResumeFilePath:()=>h,getResumeStats:()=>I,saveContact:()=>v,saveInterviewData:()=>F,saveResume:()=>w,saveResumeFile:()=>g,updateContact:()=>S,updateInterview:()=>C,updateResume:()=>m});var a=n(7147),r=n(1017),i=n.n(r);let s=i().join(process.cwd(),"data"),u=i().join(s,"resumes.json"),o=i().join(s,"contacts.json"),l=i().join(s,"interviews.json"),c=i().join(s,"uploads");async function d(){try{await a.promises.mkdir(s,{recursive:!0}),await a.promises.mkdir(c,{recursive:!0})}catch(t){}}async function f(){try{await d();let t=await a.promises.readFile(u,"utf-8");return JSON.parse(t)}catch(t){return[]}}async function w(t){await d();let e=await f(),n={...t,id:O(),submittedAt:new Date().toISOString(),status:"new"};return e.push(n),await a.promises.writeFile(u,JSON.stringify(e,null,2)),n}async function m(t,e){let n=await f(),r=n.findIndex(e=>e.id===t);return -1===r?null:(n[r]={...n[r],...e},await a.promises.writeFile(u,JSON.stringify(n,null,2)),n[r])}async function p(t){let e=await f();return e.find(e=>e.id===t)||null}async function g(t,e){await d();let n=i().extname(t.name),r=`${e}${n}`,s=i().join(c,r),u=await t.arrayBuffer();return await a.promises.writeFile(s,Buffer.from(u)),r}function h(t){return i().join(c,t)}async function y(){try{await d();let t=await a.promises.readFile(o,"utf-8");return JSON.parse(t)}catch(t){return[]}}async function v(t){await d();let e=await y(),n={...t,id:O(),submittedAt:new Date().toISOString(),status:"new"};return e.unshift(n),await a.promises.writeFile(o,JSON.stringify(e,null,2)),n}async function S(t,e){let n=await y(),r=n.findIndex(e=>e.id===t);return -1===r?null:(n[r]={...n[r],...e},await a.promises.writeFile(o,JSON.stringify(n,null,2)),n[r])}async function j(t){let e=await y();return e.find(e=>e.id===t)||null}async function A(){let t=await y();return{total:t.length,new:t.filter(t=>"new"===t.status).length,read:t.filter(t=>"read"===t.status).length,replied:t.filter(t=>"replied"===t.status).length,archived:t.filter(t=>"archived"===t.status).length}}function O(){return Math.random().toString(36).substr(2,15)}async function I(){let t=await f();return{total:t.length,new:t.filter(t=>"new"===t.status).length,reviewed:t.filter(t=>"reviewed"===t.status).length,contacted:t.filter(t=>"contacted"===t.status).length,rejected:t.filter(t=>"rejected"===t.status).length,analyzed:t.filter(t=>t.aiAnalysis).length}}async function x(){try{await d();let t=await a.promises.readFile(l,"utf-8");return JSON.parse(t)}catch(t){return[]}}async function F(t){let e=await x(),n={...t,id:O(),status:"new"};return e.push(n),await a.promises.writeFile(l,JSON.stringify(e,null,2)),n}async function C(t,e){let n=await x(),r=n.findIndex(e=>e.id===t);return -1===r?null:(n[r]={...n[r],...e},await d(),await a.promises.writeFile(l,JSON.stringify(n,null,2)),n[r])}async function J(t){let e=await x();return e.find(e=>e.id===t)||null}async function N(){let t=await x(),e=t.length,n=t.filter(t=>"new"===t.status).length,a=t.filter(t=>"reviewed"===t.status).length,r=t.filter(t=>"contacted"===t.status).length,i=t.map(t=>t.evaluation.overallScore).filter(t=>t>0),s=i.length>0?Math.round(i.reduce((t,e)=>t+e,0)/i.length):0,u=t.filter(t=>"recommended"===t.evaluation.recommendation).length,o=t.filter(t=>"consider"===t.evaluation.recommendation).length,l=t.filter(t=>"not_recommended"===t.evaluation.recommendation).length;return{total:e,new:n,reviewed:a,contacted:r,rejected:t.filter(t=>"rejected"===t.status).length,averageScore:s,recommendations:{recommended:u,consider:o,notRecommended:l}}}}};var e=require("../../../../webpack-runtime.js");e.C(t);var n=t=>e(e.s=t),a=e.X(0,[271,107],()=>n(9358));module.exports=a})();